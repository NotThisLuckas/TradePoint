<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TradePoint – Trocas de Roube Um Brainrot</title>
  <meta name="description" content="TradePoint: plataforma profissional para trocas do jogo Roube Um Brainrot com anúncios, chat, administração e segurança." />
  <meta name="theme-color" content="#0b0f1c" />
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <link id="favicon" rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%230c0f12'/><circle cx='16' cy='16' r='9' fill='%234cc9f0'/></svg>" />
  <style>
    :root { --bg:#0c0f12; --panel:#11161c; --panel2:#0e1319; --text:#e6eaf1; --muted:#9aa3ad; --white:#ffffff; --border:#1b2530; --accent:#4cc9f0; --accent2:#2b7a9c; --navText:#c7d2df; --bgGrad:#0c0f12 }
    [data-theme="light"] { --bg:#f6f7f9; --panel:#ffffff; --panel2:#f3f5f7; --text:#0f1419; --muted:#5f6b7a; --white:#ffffff; --border:#e5e7eb; --accent:#111418; --accent2:#333b44; --navText:#333b44; --bgGrad:#f6f7f9 }
    * { box-sizing: border-box }
    html, body { height:100% }
    body { margin:0; font-family:Poppins, Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bgGrad); color: var(--text) }
    a { color: inherit; text-decoration: none }
    .header { position: sticky; top:0; z-index:50; background: rgba(12,15,18,0.8); backdrop-filter: blur(8px); border-bottom: 1px solid var(--border) }
    .inner { max-width: 1200px; margin: 0 auto; padding: 14px 20px; display:flex; align-items:center; gap:16px }
    .brand { display:flex; align-items:center; gap:10px; color:var(--text) }
    .logo { width:160px; height:auto; filter: drop-shadow(0 8px 16px rgba(76,201,240,0.18)) }
    .nav { margin-left:auto; display:flex; gap: 10px; flex-wrap: wrap }
    .nav a { padding:10px 14px; border-radius:999px; color:var(--navText); transition: transform .2s ease, background .2s ease }
    .nav a:hover { transform: translateY(-2px); background: rgba(255,255,255,0.04) }
    .mobile-toggle { display:none; margin-left:auto; appearance:none; border:0; border-radius:12px; padding:10px 12px; font-weight:800; background: linear-gradient(180deg, var(--accent), var(--accent2)); color:#051425; box-shadow:0 10px 20px rgba(38,208,255,0.28) }
    .btn { appearance:none; border-radius:16px; padding:14px 22px; font-weight:800; letter-spacing:0.02em; cursor:pointer; transition: transform .25s ease, box-shadow .25s ease, filter .25s ease }
    .btn-primary { color:#041018; background: linear-gradient(180deg, var(--accent), var(--accent2)); box-shadow: 0 12px 22px rgba(76,201,240,0.20) }
    .btn-primary:hover { transform: translateY(-2px); filter: brightness(1.04) }
    .btn-secondary { color:#d7e9ff; background: linear-gradient(180deg, #121a2a, #0d1628); box-shadow: 0 12px 22px rgba(0,0,0,0.35); border:1px solid var(--border) }
    .hero { position:relative; overflow:hidden }
    .hero-inner { max-width:1200px; margin:0 auto; padding:80px 20px; display:grid; gap:18px; grid-template-columns: 1.1fr .9fr; align-items:center }
    .hero h1 { margin:0; font-size: clamp(32px, 6vw, 54px); letter-spacing:-0.02em }
    .hero p { margin:0; font-size: clamp(16px, 2.8vw, 20px); color: var(--muted) }
    .mock { width: min(520px, 100%); justify-self: center; border-radius: 20px; background: var(--panel); box-shadow: 0 24px 40px rgba(0,0,0,0.35); height: 300px; display:grid; place-items:center; color: var(--text); font-weight:800; border: 1px solid var(--border) }
    .section { max-width:1200px; margin:0 auto; padding:64px 20px }
    .section h2 { margin:0 0 14px; font-size: clamp(24px, 4.8vw, 34px) }
    .muted { color: var(--muted) }
    .grid-3 { display:grid; gap:16px; grid-template-columns: repeat(3, minmax(0, 1fr)) }
    .grid-2 { display:grid; gap:16px; grid-template-columns: repeat(2, minmax(0, 1fr)) }
    .grid-4 { display:grid; gap:16px; grid-template-columns: repeat(4, minmax(0, 1fr)) }
    .card { border-radius:16px; background: var(--panel2); box-shadow: 0 10px 24px rgba(0,0,0,0.30); padding:20px; border: 1px solid var(--border) }
    
    input, select, textarea { width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:#0f1419; color:var(--text); font-size:14px }
    input:focus, select:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(76,201,240,0.18) }
    textarea { min-height: 120px }
    .table-wrap { overflow:auto }
    .table { width:100%; border-collapse: collapse }
    .table th, .table td { border-bottom: 1px solid var(--border); padding:8px }
    .footer { border-top: 1px solid var(--border); background: #0b111f; margin-top:40px }
    .footer-inner { max-width:1200px; margin:0 auto; padding:24px 20px; display:grid; gap:16px; grid-template-columns: 1.2fr .8fr; align-items:center }
    .footer-links { display:flex; gap:12px; flex-wrap: wrap; justify-content:flex-end }
    .scroll-x { overflow-x:auto; white-space:nowrap }
    .chip { display:inline-flex; align-items:center; gap:6px; border:1px solid var(--border); border-radius:12px; padding:6px 10px; background:#0f1419; color:var(--text) }
    .reveal { opacity:0; transform:translateY(12px); transition: opacity .45s ease, transform .45s ease }
    .reveal.on { opacity:1; transform:translateY(0) }
    section, .hero { scroll-margin-top: 80px }
    @media (max-width: 900px) { .hero-inner { grid-template-columns:1fr; text-align:center } .mobile-toggle { display:inline-flex } .nav { position: fixed; top:0; right:0; width:74vw; max-width:340px; height:100dvh; background:#0b111f; box-shadow: -16px 0 40px rgba(0,0,0,0.35); display:flex; flex-direction:column; padding:18px; gap:10px; transform: translateX(100%); transition: transform .3s ease; z-index:60 } .nav.open { transform: translateX(0); display:flex } }
    #toast { position: fixed; right: 20px; bottom: 20px; z-index: 80; display: grid; gap: 8px }
    .toast { background: linear-gradient(180deg, var(--panel), var(--panel2)); color: var(--text); border: 1px solid var(--border); border-radius: 14px; padding: 12px 14px; box-shadow: 0 12px 24px rgba(0,0,0,0.30); opacity: 0; transform: translateY(10px); transition: opacity .3s ease, transform .3s ease }
    .toast.on { opacity: 1; transform: translateY(0) }
    @media (max-width: 700px) { .grid-3, .grid-2, .grid-4 { grid-template-columns:1fr } .btn { padding:12px 18px } input, select, textarea { font-size:16px } .mock { width: 100%; height: 240px } }
    @media (prefers-reduced-motion: reduce) { * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important } }
  </style>
</head>
<body>
  <header class="header">
    <div class="inner">
      <div class="brand"><img class="logo" src="logo.png" alt="TradePoint" /><strong>TradePoint</strong></div>
      <button id="menuBtn" class="mobile-toggle" aria-label="Abrir menu">Menu</button>
      <button id="themeBtn" class="btn btn-secondary" style="margin-left:8px">Tema</button>
      <nav class="nav" id="navMain">
        <a href="#inicio">Home</a>
        <a href="#explorar">Explorar Trocas</a>
        <a href="#criar">Criar Anúncio</a>
        <a href="#chat">Chat</a>
        <a href="#perfil">Perfil</a>
        <a href="#adm">Painel ADM</a>
        <a href="#conta">Login</a>
        <a href="#conta" class="btn btn-primary">Cadastro</a>
      </nav>
    </div>
  </header>

  <section id="inicio" class="hero">
    <div class="hero-inner">
      <div class="reveal"><h1>TradePoint — Trocas seguras de Roube Um Brainrot</h1><p>Crie anúncios temporários, converse no chat, chame ADM e finalize trocas com avaliações.</p><div style="margin-top:18px; display:flex; gap:12px; flex-wrap:wrap; align-items:center"><a href="#criar" class="btn btn-primary">Criar anúncio</a><a href="#explorar" class="btn btn-secondary">Explorar Trocas</a></div></div>
      <div class="mock reveal">Vitrine de Trocas</div>
    </div>
  </section>

  <section id="explorar" class="section reveal" style="display:none">
    <h2>Vitrine de Trocas</h2>
    <div class="card" style="display:grid; gap:10px"><div style="display:flex; flex-wrap:wrap; gap:10px"><input id="fText" placeholder="Buscar" /><input id="fBrain" placeholder="Nome do brainrot" /><select id="fRarity"><option value="">Raridade</option><option>comum</option><option>raro</option><option>épico</option><option>lendário</option><option>mítico</option><option>God</option><option>Secret</option><option>OG</option></select><input id="fUser" placeholder="Usuário" /><input id="fDate" type="date" /><button id="fApply" class="btn btn-secondary">Filtrar</button><button id="refreshPosts" class="btn btn-secondary">Atualizar anúncios</button></div><div id="exploreStatus" class="muted"></div><div id="listPosts" class="grid-3"></div><div style="display:flex; gap:10px; margin-top:10px"><button id="pgPrev" class="btn btn-secondary">Anterior</button><button id="pgNext" class="btn btn-secondary">Próximo</button><span class="muted" id="pgInfo"></span></div></div>
    <h3 style="margin-top:24px">Avaliações Recentes</h3>
    <div class="card scroll-x" id="recentReviews" style="padding:10px; white-space:nowrap"></div>
  </section>

  <section id="criar" class="section reveal" style="display:none">
    <h2>Criar Anúncio</h2>
    <div class="grid-2"><div class="card"><h3>Dados</h3><div style="display:grid; gap:10px"><input id="pImage" placeholder="Foto (URL)" /><input id="pName" placeholder="Nome do brainrot" /><select id="pRarity"><option>comum</option><option>raro</option><option>épico</option><option>lendário</option><option>mítico</option><option>God</option><option>Secret</option><option>OG</option></select><input id="pHave" placeholder="Item que possui" /><input id="pWant" placeholder="Item que procura" /><textarea id="pDesc" placeholder="Descrição (opcional)"></textarea><div class="muted">Expira em: <span id="pExpire">24h</span></div><button id="pCreate" class="btn btn-primary">Publicar</button></div></div><div class="card"><h3>Regras</h3><div class="muted">Anúncios expiram em 24 horas e devem ser repostados. Use imagens reais e descreva claramente sua oferta e procura.</div></div></div>
  </section>

  <section id="chat" class="section reveal" style="display:none">
    <h2>Chats</h2>
    <div class="grid-2"><div class="card"><h3>Conversas abertas</h3><ul id="chatList" style="margin:0; padding-left:20px"></ul></div><div class="card"><h3>Sala</h3><div id="chatBox" style="height:44vh; overflow:auto; display:flex; flex-direction:column; gap:8px; padding:10px; background:var(--panel2); border:1px solid var(--border); border-radius:12px"></div><div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap"><input id="chatText" placeholder="Mensagem" /><input id="chatImg" placeholder="Imagem (URL)" /><button id="chatSend" class="btn btn-primary">Enviar</button><button id="chatAdm" class="btn btn-secondary">Chamar ADM</button></div></div></div>
  </section>

  <section id="perfil" class="section reveal" style="display:none">
    <h2>Perfil do Usuário</h2>
    <div class="grid-2"><div class="card"><h3>Informações</h3><div style="display:grid; gap:10px"><img class="logo" src="logo.png" alt="TradePoint" style="width:120px" /><input id="uPhoto" placeholder="Foto (URL)" /><input id="uName" placeholder="Nome" /><input id="uRoblox" placeholder="ID Roblox (opcional)" /><div class="muted">Reputação: <span id="uRep">0</span></div><button id="uSave" class="btn btn-secondary">Salvar Perfil</button></div></div><div class="card"><h3>Histórico</h3><div class="table-wrap"><table class="table" id="tHistory"><thead><tr><th>Brainrot</th><th>Status</th><th>Data</th></tr></thead><tbody></tbody></table></div><h3 style="margin-top:14px">Avaliações</h3><div class="table-wrap"><table class="table" id="tReviews"><thead><tr><th>Avaliador</th><th>Brainrot</th><th>Tipo</th><th>Data</th></tr></thead><tbody></tbody></table></div></div></div>
  </section>

  <section id="adm" class="section reveal" style="display:none">
    <h2>Painel ADM</h2>
    <div id="admLogin" class="card"><div style="display:grid; gap:10px"><img class="logo" src="logo.png" alt="TradePoint" style="width:120px" /><input id="adUser" placeholder="Usuário" /><input id="adPass" type="password" placeholder="Senha" /><button id="adDo" class="btn btn-primary">Entrar</button></div></div>
    <div id="admPanel" style="display:none">
      <div class="grid-3">
        <div class="card"><h3>Usuários</h3><div class="table-wrap"><table class="table" id="tUsers"><thead><tr><th>Nome</th><th>Email</th><th>Rep</th><th>Role</th><th>Status</th><th>Ações</th></tr></thead><tbody></tbody></table></div></div>
        <div class="card"><h3>Anúncios</h3><div class="table-wrap"><table class="table" id="tPosts"><thead><tr><th>Brainrot</th><th>Raridade</th><th>Usuário</th><th>Status</th><th>Criado</th><th>Ações</th></tr></thead><tbody></tbody></table></div></div>
        <div class="card"><h3>Chamados</h3><div class="table-wrap"><table class="table" id="tCases"><thead><tr><th>ID</th><th>Chat</th><th>Usuários</th><th>Status</th><th>Ações</th></tr></thead><tbody></tbody></table></div></div>
        <div class="card"><h3>Configurações</h3><div style="display:grid; gap:10px"><input id="logoURL" placeholder="URL da logo (PNG/JPG/SVG)" /><button id="logoSet" class="btn btn-secondary">Salvar Logo</button><input type="file" id="logoFile" accept="image/*" /><button id="logoUpload" class="btn btn-secondary">Enviar Logo</button><input id="apiBase" placeholder="API Base URL (ex: https://seu-backend.com)" /><button id="apiSet" class="btn btn-secondary">Salvar API</button></div><div class="muted">Defina logo, envie arquivo ou configure a API. Se a API não estiver definida, o sistema usa modo local.</div></div>
        <div class="card"><h3>Avisos globais</h3><div style="display:flex; gap:10px"><input id="avText" placeholder="Texto" /><button id="avSet" class="btn btn-secondary">Publicar</button></div><div id="avBox" style="margin-top:8px" class="muted"></div></div>
        <div class="card"><h3>Logs</h3><div class="table-wrap"><table class="table" id="tLogs"><thead><tr><th>Quando</th><th>Quem</th><th>Ação</th><th>Detalhes</th></tr></thead><tbody></tbody></table></div></div>
      </div>
    </div>
    </div>
  </section>

  <section id="conta" class="section reveal" style="display:none">
    <h2>Conta</h2>
    <div class="grid-2"><div class="card"><h3>Cadastro</h3><div style="display:grid; gap:10px"><img class="logo" src="logo.png" alt="TradePoint" style="width:120px" /><input id="cEmail" placeholder="Email" /><input id="cPass" type="password" placeholder="Senha" /><input id="cName" placeholder="Nome" /><button id="cDo" class="btn btn-primary">Cadastrar</button></div></div><div class="card"><h3>Login</h3><div style="display:grid; gap:10px"><img class="logo" src="logo.png" alt="TradePoint" style="width:120px" /><input id="lEmail" placeholder="Email" /><input id="lPass" type="password" placeholder="Senha" /><button id="lDo" class="btn btn-secondary">Entrar</button><input id="resetEmail" placeholder="Email para redefinir senha" /><button id="resetDo" class="btn btn-secondary">Redefinir senha</button></div></div></div>
  </section>

  <footer class="footer"><div class="footer-inner"><div class="brand"><img class="logo" src="logo.png" alt="TradePoint" style="width:120px" /></div><div class="footer-links"><a href="#">Explicação do site</a><a href="#explorar">Explorar</a><a href="#criar">Criar anúncio</a><a href="#chat">Chat</a><a href="#perfil">Perfil</a><a href="#adm">Painel ADM</a></div></div></footer>

  <div id="overlay" class="overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.35); backdrop-filter: blur(2px); opacity:0; pointer-events:none; transition:opacity .3s ease"></div>
  <div id="toast"></div>
  <script>
    const K_USERS='tp_users', K_SESS='tp_session', K_POSTS='tp_posts', K_CHATS='tp_chats', K_CASES='tp_cases', K_LOGS='tp_logs', K_REVIEWS='tp_reviews', K_AV='tp_notices', K_LOGO='tp_logo_url', K_THEME='tp_theme', K_API='tp_api'
    const DEFAULT_LOGO_URL='https://chatgpt.com/s/m_692e020a7b44819186d6d7f77cff9a3c'
    const FALLBACK_SVG='data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#d1d6de"/><stop offset="1" stop-color="#9aa3ad"/></linearGradient></defs><rect width="256" height="256" rx="24" fill="#ffffff"/><path d="M70 70 L70 186 L186 128 Z" fill="url(#g)"/><text x="128" y="230" font-size="42" fill="#111418" text-anchor="middle" font-family="Poppins">TradePoint</text></svg>')
    function logoUrl(){ return localStorage.getItem(K_LOGO) || DEFAULT_LOGO_URL }
    function applyLogo(){
      const targets=[...document.querySelectorAll('img.logo')]
      const fav=document.getElementById('favicon')
      const url=logoUrl()
      const isImgLink=/\.(png|jpg|jpeg|gif|svg)(\?.*)?$/i.test(url||'') || /^data:image\//i.test(url||'')
      const setAll=(src)=>{ targets.forEach(el=>{ el.src=src }) ; if(fav) fav.href=src }
      if(!url || !isImgLink){ setAll(FALLBACK_SVG); return }
      const img=new Image(); img.crossOrigin='anonymous'; img.onload=function(){ setAll(url) }; img.onerror=function(){ setAll(FALLBACK_SVG) }; img.src=url
      targets.forEach(el=>{ el.src=FALLBACK_SVG })
    }
    function seed(){ if(!localStorage.getItem(K_USERS)){ localStorage.setItem(K_USERS, JSON.stringify([{id:'admin', email:'admin@tp', pass:'TradePoint#2025', name:'Admin', role:'admin', photo:'', rep:0, verified:true, muted:false, banned:false, roblox:''}])) } if(!localStorage.getItem(K_POSTS)){ localStorage.setItem(K_POSTS, JSON.stringify([])) } if(!localStorage.getItem(K_CHATS)){ localStorage.setItem(K_CHATS, JSON.stringify([])) } if(!localStorage.getItem(K_CASES)){ localStorage.setItem(K_CASES, JSON.stringify([])) } if(!localStorage.getItem(K_LOGS)){ localStorage.setItem(K_LOGS, JSON.stringify([])) } if(!localStorage.getItem(K_REVIEWS)){ localStorage.setItem(K_REVIEWS, JSON.stringify([])) } if(!localStorage.getItem(K_AV)){ localStorage.setItem(K_AV, '') } }
    function getUsers(){ try{return JSON.parse(localStorage.getItem(K_USERS)||'[]')}catch{return[]} }
    function setUsers(v){ localStorage.setItem(K_USERS, JSON.stringify(v)) }
    function getPosts(){ try{return JSON.parse(localStorage.getItem(K_POSTS)||'[]')}catch{return[]} }
    function setPosts(v){ localStorage.setItem(K_POSTS, JSON.stringify(v)) }
    function getChats(){ try{return JSON.parse(localStorage.getItem(K_CHATS)||'[]')}catch{return[]} }
    function setChats(v){ localStorage.setItem(K_CHATS, JSON.stringify(v)) }
    function getCases(){ try{return JSON.parse(localStorage.getItem(K_CASES)||'[]')}catch{return[]} }
    function setCases(v){ localStorage.setItem(K_CASES, JSON.stringify(v)) }
    function getLogs(){ try{return JSON.parse(localStorage.getItem(K_LOGS)||'[]')}catch{return[]} }
    function setLogs(v){ localStorage.setItem(K_LOGS, JSON.stringify(v)) }
    function getReviews(){ try{return JSON.parse(localStorage.getItem(K_REVIEWS)||'[]')}catch{return[]} }
    function setReviews(v){ localStorage.setItem(K_REVIEWS, JSON.stringify(v)) }
    function getNotice(){ return localStorage.getItem(K_AV)||'' }
    function setNotice(v){ localStorage.setItem(K_AV, v) }
    function getSession(){ try{return JSON.parse(localStorage.getItem(K_SESS)||'null')}catch{return null} }
    function setSession(v){ localStorage.setItem(K_SESS, JSON.stringify(v)) }
    function me(){ const s=getSession(); if(!s) return null; return getUsers().find(u=>u.id===s.id) }
    function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36) }
    function now(){ return new Date().toISOString() }
    function canAct(key,ms){ const k='tp_th_'+key; const last=parseInt(localStorage.getItem(k)||'0',10); const t=Date.now(); if(t-last<ms) return false; localStorage.setItem(k,String(t)); return true }
    function route(){ const h=window.location.hash||''; const ids=['inicio','explorar','criar','chat','perfil','adm','conta']; ids.forEach(id=>{ const el=document.getElementById(id); if(!el) return; const show=('#'+id===h)|| (h===''&&id==='inicio'); el.style.display= show ? 'block' : 'none' }); if(h==='#explorar'){ ANN_CACHE=null; const st=document.getElementById('exploreStatus'); if(st) st.textContent='Atualizando'; renderExplore(); renderRecentReviews() } if(h==='#chat'){ renderChatList() } if(h==='#perfil'){ renderProfile() } if(h==='#adm'){ document.getElementById('admLogin').style.display='block'; document.getElementById('admPanel').style.display='none'; renderAdminTables() } }
    function apiBase(){ return localStorage.getItem(K_API)||'' }
    async function fetchAnnouncements(){ const base=apiBase(); const status=document.getElementById('exploreStatus'); if(!base){ status.textContent='Modo local'; return { ok:true, data:getPosts().filter(p=>p.status==='active').sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt)) } } try{ const res=await fetch(base.replace(/\/$/,'')+'/announcements?t='+Date.now(),{cache:'no-store'}); if(!res.ok){ status.textContent='Falha no backend'; return { ok:false, data:getPosts().filter(p=>p.status==='active').sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt)) } } const json=await res.json(); status.textContent='Conectado ao backend'; return { ok:true, data:(json||[]).filter(p=>p.status==='active').sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt)) } } catch(e){ status.textContent='Sem conexão ao backend'; return { ok:false, data:getPosts().filter(p=>p.status==='active').sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt)) } }
    let ANN_CACHE=null
    function applyTheme(){ const t=localStorage.getItem(K_THEME)||'dark'; document.documentElement.setAttribute('data-theme', t) }
    function toggleTheme(){ const t=document.documentElement.getAttribute('data-theme')==='light'?'dark':'light'; localStorage.setItem(K_THEME,t); applyTheme() }
    function toast(msg){ const box=document.getElementById('toast'); const div=document.createElement('div'); div.className='toast'; div.textContent=msg; box.appendChild(div); requestAnimationFrame(()=>div.classList.add('on')); setTimeout(()=>{ div.classList.remove('on'); setTimeout(()=>div.remove(),250) }, 2000) }
    function expireSweep(){ const posts=getPosts(); const t=Date.now(); let ch=false; for(const p of posts){ if(p.status==='active' && t>=new Date(p.expiresAt).getTime()){ p.status='expired'; ch=true } if(p.status!=='removed' && !p.createdAt){ p.createdAt=new Date().toISOString(); ch=true } } if(ch) setPosts(posts) }
    function timeLeft(expiresAt){ const ms=new Date(expiresAt).getTime()-Date.now(); const h=Math.max(0, Math.floor(ms/3600000)); return h+'h' }
    async function renderExplore(){ try{ expireSweep(); if(!ANN_CACHE){ const res=await fetchAnnouncements(); ANN_CACHE=res.data } const posts=ANN_CACHE.slice(); const q=(document.getElementById('fText').value||'').toLowerCase(); const b=(document.getElementById('fBrain').value||'').toLowerCase(); const r=(document.getElementById('fRarity').value||''); const u=(document.getElementById('fUser').value||'').toLowerCase(); const d=(document.getElementById('fDate').value||''); let list=posts.filter(p=> (!q || (p.name.toLowerCase().includes(q)||p.desc.toLowerCase().includes(q)||p.have.toLowerCase().includes(q)||p.want.toLowerCase().includes(q))) && (!b || p.name.toLowerCase().includes(b)) && (!r || p.rarity===r) && (!u || (getUsers().find(x=>x.id===p.userId)?.name||'').toLowerCase().includes(u)) && (!d || (p.createdAt||'').slice(0,10)===d) ); list=list.sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt)); const pageSize=6; const page=parseInt(localStorage.getItem('tp_page')||'1',10); const pages=Math.max(1, Math.ceil(list.length/pageSize)); const cur=Math.min(page,pages); localStorage.setItem('tp_page',String(cur)); const slice=list.slice((cur-1)*pageSize, cur*pageSize); const box=document.getElementById('listPosts'); box.innerHTML=''; for(const p of slice){ const u=getUsers().find(x=>x.id===p.userId); const card=document.createElement('div'); card.className='card'; card.innerHTML=`<div style='display:grid; gap:8px'><img src='${p.image||''}' alt='brainrot' style='width:100%; height:180px; object-fit:cover; border-radius:14px' onerror="this.style.display='none'"/><div style='display:flex; gap:8px; flex-wrap:wrap'><span class='chip'>${p.name}</span><span class='chip'>${p.rarity}</span><span class='chip'>${u?u.name:'?'}</span><span class='chip'>${p.status==='expired'?'Expirado':'Expira em '+timeLeft(p.expiresAt)}</span></div><div class='muted'>Possui: ${p.have} · Procura: ${p.want}</div><div style='display:flex; gap:10px; flex-wrap:wrap'><button class='btn btn-primary' data-id='${p.id}' data-act='contact'>Entrar em contato</button></div></div>`; box.appendChild(card) } document.getElementById('pgInfo').textContent=`Página ${cur}/${pages}`; box.querySelectorAll('button[data-act=contact]').forEach(b=>b.addEventListener('click',(e)=>{ const id=e.currentTarget.getAttribute('data-id'); openChatForPost(id) })); const st=document.getElementById('exploreStatus'); if(st) st.textContent='' } catch(e){ console.error(e); const st=document.getElementById('exploreStatus'); if(st) st.textContent='Erro na renderização'; toast('Erro ao renderizar anúncios') } }
    function renderRecentReviews(){ const list=getReviews().slice(-12).reverse(); const box=document.getElementById('recentReviews'); box.innerHTML=''; for(const r of list){ const u=getUsers().find(x=>x.id===r.by); const div=document.createElement('div'); div.className='chip'; div.style.marginRight='8px'; div.innerHTML=`<span>${u?u.name:'?'}</span><span>${r.brain}</span><span>${r.type==='pos'?'Positiva':'Negativa'}</span><span>${new Date(r.date).toLocaleDateString()}</span>`; box.appendChild(div) } }
    function openChatForPost(postId){ const u=me(); if(!u){ toast('Entre na conta primeiro'); window.location.hash='#conta'; return } const posts=getPosts(); const p=posts.find(x=>x.id===postId); if(!p){ toast('Anúncio não encontrado'); return } let chats=getChats(); let chat=chats.find(c=>c.postId===postId && ((c.aId===u.id)||(c.bId===u.id))); if(!chat){ chat={id:uid(), postId, aId:p.userId, bId:u.id, msgs:[], caseId:null, status:'open'}; chats.push(chat); setChats(chats) } window.location.hash='#chat'; renderChatList(); selectChat(chat.id) }
    function renderChatList(){ const u=me(); const list=document.getElementById('chatList'); list.innerHTML=''; const chats=getChats().filter(c=> c.aId===u?.id || c.bId===u?.id ); for(const c of chats){ const p=getPosts().find(x=>x.id===c.postId); const li=document.createElement('li'); li.innerHTML=`<a href='#' data-id='${c.id}' class='chatSel'>${p?p.name:'(apagado)'} — ${c.status}</a>`; list.appendChild(li) } list.querySelectorAll('.chatSel').forEach(a=>a.addEventListener('click',(e)=>{ e.preventDefault(); selectChat(e.currentTarget.getAttribute('data-id')) })) }
    function selectChat(id){ localStorage.setItem('tp_chat',id); const box=document.getElementById('chatBox'); box.innerHTML=''; const chat=getChats().find(c=>c.id===id); if(!chat) return; for(const m of chat.msgs){ const d=document.createElement('div'); d.style.borderRadius='12px'; d.style.padding='8px 10px'; d.style.maxWidth='80%'; d.style.background= m.from===me()?.id ? '#162235' : '#0f1a2b'; d.style.alignSelf= m.from===me()?.id ? 'flex-end' : 'flex-start'; d.textContent= m.type==='text' ? m.content : ''; if(m.type==='img'){ const img=document.createElement('img'); img.src=m.content; img.style.maxWidth='80%'; img.style.borderRadius='12px'; d.textContent=''; d.appendChild(img) } box.appendChild(d) } box.scrollTop=box.scrollHeight }
    function sendMsg(){ const id=localStorage.getItem('tp_chat'); const chats=getChats(); const i=chats.findIndex(c=>c.id===id); if(i<0){ toast('Selecione um chat'); return } const txt=document.getElementById('chatText').value.trim(); const img=document.getElementById('chatImg').value.trim(); if(!txt && !img){ toast('Escreva ou informe uma imagem'); return } if(!canAct('msg',500)) return; chats[i].msgs.push({from:me().id, type: img ? 'img':'text', content: img||txt, time: now()}); setChats(chats); document.getElementById('chatText').value=''; document.getElementById('chatImg').value=''; selectChat(id); toast('Mensagem enviada') }
    function callAdm(){ const id=localStorage.getItem('tp_chat'); const chats=getChats(); const chat=chats.find(c=>c.id===id); if(!chat){ toast('Selecione um chat'); return } if(chat.caseId){ toast('Já encaminhado ao ADM'); return } const caseId=uid(); chat.caseId=caseId; setChats(chats); const cases=getCases(); cases.push({id:caseId, chatId:id, postId:chat.postId, aId:chat.aId, bId:chat.bId, status:'open', actions:[], createdAt:now()}); setCases(cases); const logs=getLogs(); logs.push({time:now(), who:me().id, act:'chamar_adm', detail:id}); setLogs(logs); toast('ADM notificado') }
    function reviewUser(targetId, postId, brain, type){ const revs=getReviews(); revs.push({id:uid(), user:targetId, by:me().id, postId, brain, type, date:now()}); setReviews(revs); const users=getUsers(); const i=users.findIndex(u=>u.id===targetId); if(i>-1){ users[i].rep += (type==='pos'?1:-1); setUsers(users) } }
    function renderProfile(){ const u=me(); if(!u){ window.location.hash='#conta'; return } document.getElementById('uName').value=u.name||''; document.getElementById('uPhoto').value=u.photo||''; document.getElementById('uRoblox').value=u.roblox||''; document.getElementById('uRep').textContent=u.rep||0; const posts=getPosts().filter(p=>p.userId===u.id); const tbody=document.querySelector('#tHistory tbody'); tbody.innerHTML=''; for(const p of posts){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${p.name}</td><td>${p.status}</td><td>${new Date(p.createdAt).toLocaleString()}</td>`; tbody.appendChild(tr) } const revs=getReviews().filter(r=>r.user===u.id); const tbodyR=document.querySelector('#tReviews tbody'); tbodyR.innerHTML=''; for(const r of revs){ const by=getUsers().find(x=>x.id===r.by); const tr=document.createElement('tr'); tr.innerHTML=`<td>${by?by.name:'?'}</td><td>${r.brain}</td><td>${r.type==='pos'?'Positiva':'Negativa'}</td><td>${new Date(r.date).toLocaleString()}</td>`; tbodyR.appendChild(tr) } }
    function saveProfile(){ const u=me(); if(!u){ return } const users=getUsers(); const i=users.findIndex(x=>x.id===u.id); users[i].name=document.getElementById('uName').value; users[i].photo=document.getElementById('uPhoto').value; users[i].roblox=document.getElementById('uRoblox').value; setUsers(users); renderProfile(); toast('Perfil salvo') }
    async function createPost(){ const u=me(); if(!u){ toast('Entre na conta primeiro'); window.location.hash='#conta'; return } const image=document.getElementById('pImage').value.trim(); const name=document.getElementById('pName').value.trim(); const rarity=document.getElementById('pRarity').value; const have=document.getElementById('pHave').value.trim(); const want=document.getElementById('pWant').value.trim(); const desc=document.getElementById('pDesc').value.trim(); if(!name||!have||!want){ toast('Preencha os campos obrigatórios'); return } const createdAt=now(); const expiresAt=new Date(Date.now()+24*3600*1000).toISOString(); const item={id:uid(), userId:u.id, image, name, rarity, have, want, desc, createdAt, expiresAt, status:'active'}; const base=apiBase(); let ok=false; if(base){ try{ const res=await fetch(base.replace(/\/$/,'')+'/announcements',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(item)}); ok=res.ok }catch(e){ ok=false } } if(!ok){ const posts=getPosts(); posts.push(item); setPosts(posts) } ANN_CACHE=null; toast('Publicado'); window.location.hash='#explorar'; await verifyListing(item.id) }
    async function verifyListing(id){ const res=await fetchAnnouncements(); const found=(res.data||[]).some(p=>p.id===id); const status=document.getElementById('exploreStatus'); ANN_CACHE=res.data; if(found){ status.textContent='Anúncio online'; renderExplore() } else { status.textContent='Falha na listagem'; toast('Falha na listagem') } }
    function renderAdminTables(){ const users=getUsers(); const tbody=document.querySelector('#tUsers tbody'); if(!tbody) return; tbody.innerHTML=''; for(const u of users){ const st=(u.banned?'Banido':(u.muted?'Mutado':'OK')); const tr=document.createElement('tr'); tr.innerHTML=`<td>${u.name}</td><td>${u.email||''}</td><td>${u.rep||0}</td><td>${u.role||'user'}</td><td>${st}</td><td><button data-id='${u.id}' data-act='ban'>Banir/Desbanir</button><button data-id='${u.id}' data-act='mute'>Mutar/Desmutar</button></td>`; tbody.appendChild(tr) } const posts=getPosts(); const tbodyP=document.querySelector('#tPosts tbody'); tbodyP.innerHTML=''; for(const p of posts){ const u=users.find(x=>x.id===p.userId); const tr=document.createElement('tr'); tr.innerHTML=`<td>${p.name}</td><td>${p.rarity}</td><td>${u?u.name:'?'}</td><td>${p.status}</td><td>${new Date(p.createdAt).toLocaleString()}</td><td><button data-id='${p.id}' data-act='remove'>Remover</button><button data-id='${p.id}' data-act='confirm'>Confirmar troca</button></td>`; tbodyP.appendChild(tr) } const cases=getCases(); const tbodyC=document.querySelector('#tCases tbody'); tbodyC.innerHTML=''; for(const c of cases){ const uA=users.find(x=>x.id===c.aId), uB=users.find(x=>x.id===c.bId); const tr=document.createElement('tr'); tr.innerHTML=`<td>${c.id.slice(-6)}</td><td>${c.chatId.slice(-6)}</td><td>${uA?uA.name:'?'} · ${uB?uB.name:'?'}</td><td>${c.status}</td><td><button data-id='${c.id}' data-act='close'>Encerrar</button><button data-id='${c.id}' data-act='sus'>Sinalizar suspeito</button></td>`; tbodyC.appendChild(tr) } const tbodyL=document.querySelector('#tLogs tbody'); tbodyL.innerHTML=''; const logs=getLogs().slice(-40).reverse(); for(const l of logs){ const u=users.find(x=>x.id===l.who); const tr=document.createElement('tr'); tr.innerHTML=`<td>${new Date(l.time).toLocaleString()}</td><td>${u?u.name:'?'}</td><td>${l.act}</td><td>${l.detail||''}</td>`; tbodyL.appendChild(tr) } document.getElementById('avBox').textContent=getNotice(); const panel=document.getElementById('admPanel'); if(panel) panel.querySelectorAll('button').forEach(b=>b.addEventListener('click',onAdminAction)) }
    function onAdminAction(e){ const id=e.currentTarget.getAttribute('data-id'); const act=e.currentTarget.getAttribute('data-act'); const users=getUsers(); const posts=getPosts(); const cases=getCases(); const logs=getLogs(); if(act==='ban'){ const i=users.findIndex(u=>u.id===id); if(i>-1){ users[i].banned=!users[i].banned; setUsers(users); logs.push({time:now(), who:me()?.id||'admin', act:users[i].banned?'ban':'unban', detail:id}); setLogs(logs) } } else if(act==='mute'){ const i=users.findIndex(u=>u.id===id); if(i>-1){ users[i].muted=!users[i].muted; setUsers(users); logs.push({time:now(), who:me()?.id||'admin', act:users[i].muted?'mute':'unmute', detail:id}); setLogs(logs) } } else if(act==='remove'){ const i=posts.findIndex(p=>p.id===id); if(i>-1){ posts[i].status='removed'; setPosts(posts); logs.push({time:now(), who:me()?.id||'admin', act:'remove_post', detail:id}); setLogs(logs) } } else if(act==='confirm'){ const p=posts.find(x=>x.id===id); if(p){ const revs=getReviews(); revs.push({id:uid(), user:p.userId, by:me()?.id||'admin', postId:id, brain:p.name, type:'pos', date:now()}); setReviews(revs); logs.push({time:now(), who:me()?.id||'admin', act:'confirm_trade', detail:id}); setLogs(logs) } } else if(act==='close'){ const i=cases.findIndex(c=>c.id===id); if(i>-1){ cases[i].status='closed'; setCases(cases); logs.push({time:now(), who:me()?.id||'admin', act:'close_case', detail:id}); setLogs(logs) } } else if(act==='sus'){ const i=cases.findIndex(c=>c.id===id); if(i>-1){ logs.push({time:now(), who:me()?.id||'admin', act:'flag_suspect', detail:id}); setLogs(logs) } } renderAdminTables() }
    function verify(email){ return /.+@.+\..+/.test(email||'') }
    function register(){ const email=document.getElementById('cEmail').value.trim(); const pass=document.getElementById('cPass').value.trim(); const name=document.getElementById('cName').value.trim(); if(!verify(email)||pass.length<4||!name){ toast('Dados inválidos'); return } const users=getUsers(); if(users.find(u=>u.email===email)){ toast('Email já cadastrado'); return } const id=uid(); users.push({id,email,pass,name,role:'user',photo:'',rep:0,verified:false,muted:false,banned:false,roblox:''}); setUsers(users); setSession({id}); toast('Conta criada'); window.location.hash='#perfil'; renderProfile() }
    function login(){ const email=document.getElementById('lEmail').value.trim(); const pass=document.getElementById('lPass').value.trim(); const u=getUsers().find(u=>u.email===email&&u.pass===pass); if(!u){ toast('Credenciais inválidas'); return } if(u.banned){ toast('Conta banida'); return } setSession({id:u.id}); toast('Login realizado'); window.location.hash='#explorar'; renderExplore() }
    function reset(){ const email=document.getElementById('resetEmail').value.trim(); const u=getUsers().find(x=>x.email===email); toast(u?'Link de redefinição enviado (demo)':'Email não encontrado') }
    function admLogin(){ const user=document.getElementById('adUser').value; const pass=document.getElementById('adPass').value; const u=getUsers().find(x=>x.role==='admin' && (x.email===user||x.name===user) && x.pass===pass); if(!u){ toast('Credenciais inválidas'); return } setSession({id:u.id}); document.getElementById('admLogin').style.display='none'; document.getElementById('admPanel').style.display='block'; renderAdminTables(); toast('ADM conectado') }
    function setNoticeUI(){ const v=document.getElementById('avText').value; setNotice(v); document.getElementById('avBox').textContent=v; toast('Aviso publicado') }
    function setAPIFromUI(){ const v=document.getElementById('apiBase').value.trim(); localStorage.setItem(K_API, v); ANN_CACHE=null; toast('API salva') }
    function setLogoFromUI(){ const v=document.getElementById('logoURL').value.trim(); if(!v){ toast('Informe um link de imagem'); return } localStorage.setItem(K_LOGO, v); applyLogo(); toast('Logo atualizada') }
    function setLogoFromFile(){ const f=document.getElementById('logoFile').files[0]; if(!f){ toast('Selecione um arquivo'); return } const reader=new FileReader(); reader.onload=function(e){ const data=e.target.result; if(!/^data:image\//i.test(data||'')){ toast('Arquivo inválido'); return } localStorage.setItem(K_LOGO, data); applyLogo(); toast('Logo enviada') }; reader.readAsDataURL(f) }
    function goAnywhere(url){ if(!url) return; window.location.href=url }
    const revealEls=document.querySelectorAll('.reveal'); const io=new IntersectionObserver((entries)=>{entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('on');io.unobserve(e.target);}})},{threshold:0.25}); revealEls.forEach(el=>io.observe(el)); const menuBtn=document.getElementById('menuBtn'); const nav=document.getElementById('navMain'); const overlay=document.getElementById('overlay'); function toggleMenu(){ const open=!nav.classList.contains('open'); nav.classList.toggle('open',open); overlay.style.opacity=open?'1':'0'; overlay.style.pointerEvents=open?'auto':'none' } menuBtn.addEventListener('click',toggleMenu); overlay.addEventListener('click',toggleMenu); nav.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>{ if(nav.classList.contains('open')) toggleMenu() }));
    applyTheme(); seed(); applyLogo(); route(); window.addEventListener('hashchange',route); document.getElementById('themeBtn').addEventListener('click',toggleTheme); document.getElementById('fApply').addEventListener('click',renderExplore); document.getElementById('pgPrev').addEventListener('click',()=>{ const n=Math.max(1,parseInt(localStorage.getItem('tp_page')||'1',10)-1); localStorage.setItem('tp_page',String(n)); renderExplore() }); document.getElementById('pgNext').addEventListener('click',()=>{ const n=parseInt(localStorage.getItem('tp_page')||'1',10)+1; localStorage.setItem('tp_page',String(n)); renderExplore() }); document.getElementById('refreshPosts').addEventListener('click',()=>{ ANN_CACHE=null; localStorage.setItem('tp_page','1'); renderExplore(); toast('Atualizado') }); window.addEventListener('storage',(e)=>{ if(e.key===K_POSTS && window.location.hash==='#explorar'){ ANN_CACHE=null; renderExplore() } }); setInterval(()=>{ if(window.location.hash==='#explorar'){ ANN_CACHE=null; renderExplore() } },15000); document.getElementById('pCreate').addEventListener('click',createPost); document.getElementById('chatSend').addEventListener('click',sendMsg); document.getElementById('chatAdm').addEventListener('click',callAdm); document.getElementById('uSave').addEventListener('click',saveProfile); document.getElementById('cDo').addEventListener('click',register); document.getElementById('lDo').addEventListener('click',login); document.getElementById('resetDo').addEventListener('click',reset); document.getElementById('adDo').addEventListener('click',admLogin); document.getElementById('avSet').addEventListener('click',setNoticeUI); const logoSet=document.getElementById('logoSet'); if(logoSet) logoSet.addEventListener('click',setLogoFromUI); const logoUpload=document.getElementById('logoUpload'); if(logoUpload) logoUpload.addEventListener('click',setLogoFromFile); const apiSet=document.getElementById('apiSet'); if(apiSet) apiSet.addEventListener('click',setAPIFromUI)
  </script>
</body>
</html>
